{% extends 'base.html' %}
{% load static %}

{% block title %}–ú–æ–∏ —Ä–µ–∞–≥–µ–Ω—Ç—ã - –§–ª–æ—Ç–∞—Ü–∏—è{% endblock %}

{% block content %}
<!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
<section class="mt-20 px-6 py-12 text-center">
  <h1 class="text-4xl md:text-5xl font-extrabold mb-4 bg-gradient-to-r from-primary-blue via-primary-purple to-accent-gold bg-clip-text text-transparent animate-pulse">
    üß™ –ú–æ–∏ —Ä–µ–∞–≥–µ–Ω—Ç—ã
  </h1>
  <p class="text-lg text-slate-300 max-w-3xl mx-auto mb-10 leading-relaxed">
    –£–ø—Ä–∞–≤–ª—è–π—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π —Ä–µ–∞–≥–µ–Ω—Ç–æ–≤, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Å–º–µ—Å–∏ –¥–ª—è —Ñ–ª–æ—Ç–∞—Ü–∏–æ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
  </p>

  <!-- –ë—ã—Å—Ç—Ä–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <div class="grid gap-6 sm:grid-cols-3 max-w-4xl mx-auto">
    <div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-6 text-center hover:-translate-y-1 hover:shadow-xl transition">
      <span class="block text-2xl font-extrabold text-accent-gold mb-1">{{ reagent_stats.total }}</span>
      <span class="text-slate-300 text-sm">–í—Å–µ–≥–æ —Ä–µ–∞–≥–µ–Ω—Ç–æ–≤</span>
    </div>
    <div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-6 text-center hover:-translate-y-1 hover:shadow-xl transition">
      <span class="block text-2xl font-extrabold text-accent-gold mb-1">{{ reagent_stats.experimental }}</span>
      <span class="text-slate-300 text-sm">MP —Å–µ—Ä–∏—è</span>
    </div>
    <div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-6 text-center hover:-translate-y-1 hover:shadow-xl transition">
      <span class="block text-2xl font-extrabold text-accent-gold mb-1">{{ top_reagents.0.max_extraction|floatformat:1 }}%</span>
      <span class="text-slate-300 text-sm">–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
    </div>
  </div>
</section>

<!-- –°–µ—Ç–∫–∞ —Ä–µ–∞–≥–µ–Ω—Ç–æ–≤ -->
<section id="reagentsGrid" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3 max-w-6xl mx-auto px-6 pb-16">
  {% for reagent in reagents %}
  <div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-6 transition hover:-translate-y-1 hover:shadow-xl hover:border-accent-gold cursor-pointer reagent-card {{ reagent.type }}"
    data-category="{{ reagent.type }}" data-name="{{ reagent.name|lower }}"
    data-tags="{% for tag in reagent.tags %}{{ tag.0|lower }} {% endfor %}">
    <div class="flex items-center gap-4 mb-4">
      <div class="text-3xl">{{ reagent.icon }}</div>
      <div>
        <h3 class="text-lg font-semibold text-slate-100">{{ reagent.name }}</h3>
        <div class="text-slate-400 text-sm">{{ reagent.get_type_display }}</div>
      </div>
    </div>

    <p class="text-slate-300 text-sm mb-4">{{ reagent.description }}</p>

    <div class="flex flex-wrap gap-4 mb-4">
      {% if reagent.dosage_range.main %}
      <div>
        <div class="text-accent-gold font-semibold">{{ reagent.dosage_range.main }}</div>
        <div class="text-slate-400 text-xs">–≥/—Ç {% if reagent.dosage_range.cleaner %}(–æ—Å–Ω–æ–≤–Ω–∞—è){% endif %}</div>
      </div>
      {% endif %}
      {% if reagent.dosage_range.cleaner %}
      <div>
        <div class="text-accent-gold font-semibold">{{ reagent.dosage_range.cleaner }}</div>
        <div class="text-slate-400 text-xs">–≥/—Ç (–ø–µ—Ä–µ—á–∏—Å—Ç–∫–∞)</div>
      </div>
      {% elif reagent.max_extraction %}
      <div>
        <div class="text-accent-gold font-semibold">{{ reagent.max_extraction|floatformat:1 }}%</div>
        <div class="text-slate-400 text-xs">–ú–∞–∫—Å. –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ</div>
      </div>
      {% elif reagent.working_ph_min and reagent.working_ph_max %}
      <div>
        <div class="text-accent-gold font-semibold">pH {{ reagent.working_ph_min|floatformat:0 }}‚Äì{{ reagent.working_ph_max|floatformat:0 }}</div>
        <div class="text-slate-400 text-xs">–†–∞–±–æ—á–∏–π pH</div>
      </div>
      {% endif %}
    </div>

    <div class="flex flex-wrap gap-2 mb-4">
      {% for tag, css_class in reagent.tags %}
      <span class="px-3 py-1 rounded-full bg-white/10 border border-white/20 text-xs text-slate-200">{{ tag }}</span>
      {% endfor %}
    </div>

    <div class="flex gap-2">
      <button onclick="showReagentStats({{ reagent.id }}, '{{ reagent.name }}')" class="flex-1 px-4 py-2 rounded-lg bg-white/10 text-slate-200 hover:border-accent-gold border border-white/20 transition">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
      <button onclick="addToMixture('{{ reagent.name }}', '{{ reagent.get_type_display }}', {{ reagent.id }})" class="flex-1 px-4 py-2 rounded-lg bg-gradient-to-r from-primary-blue to-primary-purple text-white font-medium hover:shadow-xl transition">‚ûï –í —Å–º–µ—Å—å</button>
    </div>
  </div>
  {% empty %}
  <div class="text-center p-12 col-span-full text-slate-400">
    <div class="text-4xl mb-4">üß™</div>
    <h3 class="text-lg text-slate-200 mb-2">–†–µ–∞–≥–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
    <p>–î–æ–±–∞–≤—å—Ç–µ –∏—Ö —á–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.</p>
  </div>
  {% endfor %}
</section>

<!-- –ü–∞–Ω–µ–ª—å —Å–º–µ—Å–∏ -->
<div id="mixturePanel" class="fixed bottom-4 right-4 bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-6 w-80 hidden">
  <h3 class="text-lg font-semibold mb-4">üß™ –°–æ–∑–¥–∞–Ω–∏–µ —Å–º–µ—Å–∏</h3>
  <div id="mixtureReagents" class="flex flex-col gap-2 mb-4"></div>
  <div id="mixtureStats" class="hidden p-3 bg-white/5 rounded-lg mb-4">
    <div class="flex justify-between text-slate-200 text-sm">
      <span>–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ:</span>
      <span id="predictedExtraction" class="text-accent-gold font-semibold">--%</span>
    </div>
  </div>
  <div class="flex gap-2">
    <button onclick="calculateMixture()" class="flex-1 px-4 py-2 rounded-lg bg-gradient-to-r from-primary-blue to-primary-purple text-white font-medium">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
    <button onclick="clearMixture()" class="flex-1 px-4 py-2 rounded-lg bg-white/10 border border-white/20 text-slate-200">–û—á–∏—Å—Ç–∏—Ç—å</button>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
<div id="reagentModal" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50" onclick="closeReagentModal()">
  <div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl max-w-lg w-full p-6 relative" onclick="event.stopPropagation()">
    <div class="flex justify-between items-center mb-4">
      <h3 id="modalReagentName" class="text-lg font-semibold text-slate-100">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–∞–≥–µ–Ω—Ç–∞</h3>
      <button onclick="closeReagentModal()" class="text-slate-300 hover:text-white text-xl">√ó</button>
    </div>
    <div id="modalReagentContent" class="text-slate-300 text-sm">
      <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    </div>
  </div>
</div>
{% endblock %}

